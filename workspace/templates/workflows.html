{% extends "base_dashboard.html" %}
{% block title %}Workflows | ProductForge{% endblock %}
{% block content %}
<section class="max-w-6xl mx-auto">
  <h1 class="text-3xl font-bold mb-6">ðŸ§© Workflows</h1>

  <form method="POST" action="/orchestrate" class="bg-gray-800 p-4 rounded border border-purple-500/40 mb-6">
    <label class="block text-sm mb-1">Task</label>
    <textarea name="job" rows="3" class="w-full bg-gray-900 border border-gray-700 rounded p-2" placeholder="Describe the task..." required></textarea>
    <label class="mt-2 inline-flex items-center gap-2 text-sm">
      <input type="checkbox" name="requires_qa" value="true" class="accent-indigo-500" /> Requires QA
    </label>
    <div class="mt-3">
      <button class="px-4 py-2 bg-indigo-600 rounded hover:bg-indigo-500">Create Workflow</button>
    </div>
  </form>

  {% set active_list = workflows.active or [] %}
  {% set completed_list = workflows.completed or [] %}

  <h2 class="text-xl font-semibold mb-2">Active</h2>
  {% if active_list|length > 0 %}
  <table class="w-full text-sm border border-gray-700 rounded overflow-hidden mb-6">
    <thead class="bg-gray-700"><tr>
      <th class="p-2 text-left">Workflow ID</th>
      <th class="p-2 text-left">Task</th>
      <th class="p-2 text-left">Steps</th>
      <th class="p-2 text-left">Status</th>
      <th class="p-2 text-left">Created</th>
    </tr></thead>
    <tbody>
    {% for w in active_list %}
      <tr class="border-t border-gray-700">
        <td class="p-2 font-mono text-xs"><a class="text-indigo-400 underline" href="/workflows/{{ w.workflow_id }}">{{ w.workflow_id }}</a></td>
        <td class="p-2">{{ w.original_task }}</td>
        <td class="p-2">{{ w.steps|length }}</td>
        <td class="p-2">{{ w.status }}</td>
        <td class="p-2">{{ w.created_at }}</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
  {% else %}
    <p class="text-gray-400 text-sm mb-6">No active workflows.</p>
  {% endif %}

  <h2 class="text-xl font-semibold mb-2">Completed</h2>
  {% if completed_list|length > 0 %}
  <table class="w-full text-sm border border-gray-700 rounded overflow-hidden">
    <thead class="bg-gray-700"><tr>
      <th class="p-2 text-left">Workflow ID</th>
      <th class="p-2 text-left">Task</th>
      <th class="p-2 text-left">Steps</th>
      <th class="p-2 text-left">Status</th>
      <th class="p-2 text-left">Completed At</th>
    </tr></thead>
    <tbody>
    {% for w in completed_list %}
      <tr class="border-t border-gray-700">
        <td class="p-2 font-mono text-xs"><a class="text-indigo-400 underline" href="/workflows/{{ w.workflow_id }}">{{ w.workflow_id }}</a></td>
        <td class="p-2">{{ w.original_task }}</td>
        <td class="p-2">{{ w.steps|length }}</td>
        <td class="p-2">{{ w.status }}</td>
        <td class="p-2">{{ w.completed_at }}</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
  {% else %}
    <p class="text-gray-400 text-sm">No completed workflows.</p>
  {% endif %}
  </section>
{% endblock %}
